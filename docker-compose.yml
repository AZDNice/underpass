version: '3.3'

networks:
    underpass:
    default:
        driver: bridge

volumes: 
    portainer_data: {}
    projectsend_data: {}
    projectsend_config: {}
    mariadb: {}
    phpmyadmin: {}
    nginx-proxy-manager: {}
    heimdall_config: {}

services:
    pritunl:
        image: jippi/pritunl:latest
        container_name: pritunl
        restart: always
        privileged: true
        networks: 
            - underpass
        ports:
            - "$PRITUNL_WEB_UI:80"
            - "$PRITUNL_WEB_UI_HTTPS:443"
            - "$PRITUNL_TCP:1194/tcp"
            - "$PRITUNL_TCP:1194/udp"
    
    shadowsocks:
        image: easypi/shadowsocks-libev:latest
        container_name: shadowsocks
        restart: always
        networks: 
            - underpass
        ports:
            - "$SHADOWSOCKS_TCP:8388/tcp"
            - "$SHADOWSOCKS_UDP:8388/udp"
        environment: 
            - METHOD=aes-256-cfb
            - PASSWORD=$SHADOWSOCKS_PASSWORD
    
    squid:
        image: b4tman/squid:latest
        container_name: squid
        restart: always
        networks: 
            - underpass
        ports:
            - "$SQUID_PORT:3128"

    privoxy:
        image: splazit/privoxy-alpine:latest
        container_name: privoxy
        restart: always
        networks: 
            - underpass
        ports:
            - "$PRIVOXY_PORT:8118"
    
    portainer:
        image: portainer/portainer:latest
        container_name: portainer
        restart: always
        command: -H unix:///var/run/docker.sock
        networks:
            - underpass
        ports:
            - 9000:9000
            - 8000:8000
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
            - portainer_data:/data
    
    projectsend:
        image: linuxserver/projectsend:latest
        container_name: projectsend
        restart: unless-stopped
        networks: 
            - underpass
        ports:
            - "$PROJECTSEND_PORT:80"
        environment: 
            - MAX_UPLOAD=$MAX_FILE_UPLOAD_SIZE
        volumes: 
            - projectsend_config:/config
            - projectsend_data:/data

    mariadb:
        image: linuxserver/mariadb:latest
        container_name: mariadb
        restart: unless-stopped
        networks: 
            - underpass
        environment:
            - MYSQL_ROOT_PASSWORD=$MYSQL_ROOT_PASSWORD
            - TZ=$TZ
        volumes: 
            - mariadb:/config
        
    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        container_name: phpmyadmin
        restart: unless-stopped
        networks:
            - underpass
        ports:
            - "$PHPMYADMIN_PORT:80"
        environment:
            - PMA_ARBITRARY=0
            - PMA_HOST=mariadb
        volumes:
            - phpmyadmin:/sessions

    nginx-proxy-manager:
        image: jlesage/nginx-proxy-manager:latest
        container_name: nginx-proxy-manager
        restart: unless-stopped
        networks:
            - underpass
        ports:
            - 8181:8181
            - 8080:8080
            - 4443:4443
        volumes:
            - nginx-proxy-manager:/config

    heimdall:
        image: linuxserver/heimdall:latest
        container_name: heimdall
        restart: always
        networks:
            - underpass
        ports:
            - "$HEIMDALL_PORT:80"
            - "$HEIMDALL_PORT_HTTPS:443"
        volumes:
            - heimdall_config:/config

    